import{a as f}from"./chunk-GGPG3CNO.js";import{Ab as H,B as m,D as r,E as o,F as s,Kb as L,La as D,Lb as V,Ob as J,S as i,U as a,V as g,aa as h,ba as I,eb as P,ga as C,gb as T,hb as k,ib as A,ja as F,ka as y,la as S,lb as w,mb as N,nb as O,ob as $,pb as j,qb as M,r as n,rb as U,s as v,tb as G,u as E,ua as B,xb as R,y as x,yb as _,zb as z}from"./chunk-37LTOCVS.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as b}from"./chunk-RW4GY4BD.js";function K(p,c){if(p&1&&(r(0,"ion-accordion")(1,"ion-item",10)(2,"ion-label"),i(3),h(4,"number"),o()(),r(5,"div",11)(6,"p")(7,"strong"),i(8,"Descripci\xF3n:"),o(),i(9),o(),r(10,"p")(11,"strong"),i(12,"IVA:"),o(),i(13),o(),r(14,"p")(15,"strong"),i(16,"Cantidad:"),o(),i(17),o(),r(18,"p")(19,"strong"),i(20,"Precio unitario neto:"),o(),i(21),h(22,"number"),o(),r(23,"p")(24,"strong"),i(25,"Precio unitario bruto:"),o(),i(26),h(27,"number"),o()()()),p&2){let d=c.$implicit;n(3),g(" ",d.nombreProducto," - ",I(4,7,d.subtotal,"1.2-2")," \u20AC "),n(6),a(" ",d.descripcion,""),n(4),a(" ",d.iva,"%"),n(4),a(" ",d.cantidad,""),n(4),a(" ",I(22,10,d.precio,"1.2-2")," \u20AC"),n(5),a(" ",I(27,13,d.precio+d.precio*d.iva/100,"1.2-2")," \u20AC")}}var ne=(()=>{let c=class c{constructor(t,l){this.router=t,this.toastController=l,this.alertButtonsGenerar=this.crearAlertButtons(()=>this.generarPDF()),this.alertButtonsEnviar=this.crearAlertButtons(()=>this.enviarPDF())}ngOnInit(){let t=this.router.getCurrentNavigation();t!=null&&t.extras.state&&(this.pedidoId=t.extras.state.pedidoId,this.pedidoFecha=t.extras.state.pedidoFecha,this.cliente=t.extras.state.cliente,this.usuarioCreador=t.extras.state.usuarioCreador,this.loadDetalles())}loadDetalles(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let l=f.apiUrl+`/pedidos/${this.pedidoId}/detalles`;fetch(l,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(e=>{if(!e.ok)throw new Error("Error en la solicitud");return e.json()}).then(e=>{console.log("Respuesta completa:",e),typeof e=="string"&&(e=JSON.parse(e),console.log("Convertido a JSON:",e)),Array.isArray(e)?this.detalles=e:e&&e.content?this.detalles=e.content:console.warn("Formato de datos inesperado:",e)})}generarPDF(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let l=f.apiUrl+`/pedido/factura/${this.pedidoId}/pdf`;fetch(l,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(e=>{if(!e.ok)throw new Error("Error en la solicitud");return e.blob()}).then(e=>{let q=window.URL.createObjectURL(e),u=document.createElement("a");u.href=q,u.download=`pedido_${this.pedidoId}.pdf`,document.body.appendChild(u),u.click(),u.remove()}).catch(e=>{console.error("Error al generar el PDF:",e)})}enviarPDF(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let l=f.apiUrl+`/pedido/enviarFacturaClienteEmail/${this.pedidoId}`;fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(e=>e.text()).then(e=>{e.trim()==="Factura enviada correctamente"?this.presentToast("Factura enviada al cliente por email"):this.presentToast("Error en el registro: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}presentToast(t){return b(this,null,function*(){yield(yield this.toastController.create({message:t,duration:2e3,position:"top",cssClass:"toast"})).present()})}crearAlertButtons(t){return[{text:"No",cssClass:"alert-button-cancel"},{text:"Si",cssClass:"alert-button-confirm",handler:t}]}};c.\u0275fac=function(l){return new(l||c)(v(B),v(J))},c.\u0275cmp=E({type:c,selectors:[["app-pedido-detalle"]],decls:42,vars:19,consts:[[3,"translucent"],["slot","start"],["defaultHref","/pedidos"],[3,"fullscreen"],[1,"centrar"],[4,"ngFor","ngForOf"],["id","generar","expand","block","color","primary"],["trigger","generar","type","submit","header","Vas a descargar el PDF. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"],["id","enviar","expand","block","color","primary"],["trigger","enviar","type","submit","header","Vas a enviar el PDF. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"],["slot","header"],["slot","content",1,"ion-padding"]],template:function(l,e){l&1&&(r(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),s(3,"ion-back-button",2),o(),r(4,"ion-title"),i(5),o()()(),r(6,"ion-content",3)(7,"div",4)(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title"),i(11),o(),r(12,"ion-card-subtitle"),i(13),s(14,"br"),i(15),h(16,"date"),o()(),r(17,"ion-card-content"),i(18),s(19,"br"),i(20),s(21,"br"),i(22),s(23,"br"),i(24),s(25,"br"),i(26),s(27,"br")(28,"br"),i(29),s(30,"br"),o()(),r(31,"ion-accordion-group"),x(32,K,28,16,"ion-accordion",5),o()()(),r(33,"ion-footer",4)(34,"ion-button",6),i(35," Descargar Factura PDF "),o(),s(36,"br")(37,"ion-alert",7),r(38,"ion-button",8),i(39," Enviar Factura PDF al cliente "),o(),s(40,"br")(41,"ion-alert",9),o()),l&2&&(m("translucent",!0),n(5),a("Pedido #",e.pedidoId,""),n(),m("fullscreen",!0),n(5),g("",e.cliente.nombre," ",e.cliente.apellidos,""),n(2),a("NIF/DNI: ",e.cliente.nif,""),n(2),a("Fecha emisi\xF3n: ",I(16,16,e.pedidoFecha,"dd-MM-yyyy"),""),n(3),a(" Email: ",e.cliente.email,""),n(2),a(" Telefono: ",e.cliente.telefono,""),n(2),a(" Direccion: ",e.cliente.direccion,""),n(2),a(" Ciudad: ",e.cliente.ciudad,""),n(2),a(" Pais: ",e.cliente.pais,""),n(3),a(" Usuario creador: ",e.usuarioCreador,""),n(3),m("ngForOf",e.detalles),n(5),m("buttons",e.alertButtonsGenerar),n(4),m("buttons",e.alertButtonsEnviar))},dependencies:[G,_,L,V,S,C,y,F,D,T,k,z,H,w,N,P,O,$,j,M,U,R,A],encapsulation:2});let p=c;return p})();export{ne as PedidoDetallePage};
