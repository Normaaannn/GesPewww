import{a as I}from"./chunk-KX3QT6RN.js";import{B as u,D as r,E as s,F as h,J as E,K as g,Kb as M,L as v,La as z,Lb as N,Ob as F,P as L,Q as T,R as x,S as d,eb as B,ha as S,j as m,k as p,la as U,lb as P,ma as j,mb as D,q as C,r as _,s as f,tb as R,u as k,ua as V,y as w,yb as A}from"./chunk-37LTOCVS.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";var O=["fileInput"];function $(l,a){if(l&1&&h(0,"img",9),l&2){let H=v();u("src",H.logoUrl,C)}}var re=(()=>{let a=class a{constructor(o,t,e){this.http=o,this.router=t,this.toastController=e,this.logoUrl=null}ngOnInit(){this.obtenerLogo()}selectImage(){this.fileInput.nativeElement.click()}uploadImage(o){let t=o.target.files[0];if(!t)return;let e=new FileReader;e.onload=()=>{let i=new Image;i.onload=()=>{let n=document.createElement("canvas"),c=n.getContext("2d");n.width=100,n.height=100,c==null||c.drawImage(i,0,0,100,100);let Q=n.toDataURL("image/jpeg",.7).replace(/^data:image\/jpeg;base64,/,""),y=new FormData;y.append("image",Q),this.http.post("https://api.imgbb.com/1/upload?key=2f849a5d4dde177303747fa11e575984",y).subscribe({next:b=>{this.logoUrl=b.data.url,console.log("Imagen subida",this.logoUrl)},error:b=>{console.error("Error al subir la imagen",b)}})},i.src=e.result},e.readAsDataURL(t)}guardarLogo(){let o=localStorage.getItem("accessToken");if(!o){console.log("No se encontr\xF3 el token de acceso");return}let t=I.apiUrl+"/info_empresa/actualizarLogo";fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({logoUrl:this.logoUrl})}).then(e=>e.text()).then(e=>{e.trim()==="Logo actualizado"?(this.presentToast("Logo actualizado"),this.router.navigate(["/ajustes"])):this.presentToast("Error: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}obtenerLogo(){let o=localStorage.getItem("accessToken");if(!o){console.log("No se encontr\xF3 el token de acceso");return}let t=I.apiUrl+"/info_empresa/obtenerLogo";fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}).then(e=>e.text()).then(e=>{console.log("Respuesta completa:",e),e?this.logoUrl=e:console.log("No se encontr\xF3 el logo")}).catch(e=>{console.error("Error en la solicitud:",e)})}cancelar(){this.router.navigate(["/ajustes"])}presentToast(o){this.toastController.create({message:o,duration:2e3,position:"top",cssClass:"toast"}).then(t=>{t.present()})}};a.\u0275fac=function(t){return new(t||a)(f(j),f(V),f(F))},a.\u0275cmp=k({type:a,selectors:[["app-cambiar-logo-empresa"]],viewQuery:function(t,e){if(t&1&&L(O,5),t&2){let i;T(i=x())&&(e.fileInput=i.first)}},decls:18,vars:3,consts:[["fileInput",""],[3,"translucent"],["slot","start"],["defaultHref","/ajustes"],[3,"fullscreen"],[1,"centrar"],["style","width: 100px; height: 100px; display: block; margin: 0 auto;",3,"src",4,"ngIf"],["expand","block",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],[2,"width","100px","height","100px","display","block","margin","0 auto",3,"src"]],template:function(t,e){if(t&1){let i=E();r(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),h(3,"ion-back-button",3),s(),r(4,"ion-title"),d(5,"Cambiar logo empresa"),s()()(),r(6,"ion-content",4)(7,"div",5),h(8,"br"),w(9,$,1,1,"img",6),r(10,"ion-button",7),g("click",function(){return m(i),p(e.selectImage())}),d(11,"Subir Logo"),s(),r(12,"ion-button",7),g("click",function(){return m(i),p(e.guardarLogo())}),d(13,"Guardar Logo"),s(),r(14,"ion-button",7),g("click",function(){return m(i),p(e.cancelar())}),d(15,"Cancelar"),s(),r(16,"input",8,0),g("change",function(c){return m(i),p(e.uploadImage(c))}),s()()()}t&2&&(u("translucent",!0),_(6),u("fullscreen",!0),_(3),u("ngIf",e.logoUrl))},dependencies:[R,A,M,N,U,S,z,P,D,B],styles:["ion-button[_ngcontent-%COMP%]{padding:20px 20px 0}"]});let l=a;return l})();export{re as CambiarLogoEmpresaPage};
