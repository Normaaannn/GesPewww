import{a as N}from"./chunk-GGPG3CNO.js";import{B as p,D as r,E as o,F as h,Fb as H,Gb as M,Ha as j,J as w,Jb as Q,K as d,L as A,P as k,Q as T,R as x,S as g,ab as z,ga as E,gb as B,hb as D,ib as P,j as m,ja as U,k as u,ka as S,pb as R,q as _,r as f,s as v,sa as V,u as C,ub as F,y}from"./chunk-GOUZPZED.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";var O=["fileInput"];function $(l,s){if(l&1&&(r(0,"ion-avatar",9),h(1,"img",10),o()),l&2){let K=A();f(),p("src",K.avatarUrl,_)}}var ne=(()=>{let s=class s{constructor(a,t,e){this.http=a,this.router=t,this.toastController=e,this.avatarUrl=null}ngOnInit(){}selectImage(){this.fileInput.nativeElement.click()}uploadImage(a){let t=a.target.files[0];if(!t)return;let e=new FileReader;e.onload=()=>{let i=new Image;i.onload=()=>{let n=document.createElement("canvas"),c=n.getContext("2d");n.width=100,n.height=100,c==null||c.drawImage(i,0,0,100,100);let L=n.toDataURL("image/jpeg",.7).replace(/^data:image\/jpeg;base64,/,""),I=new FormData;I.append("image",L),this.http.post("https://api.imgbb.com/1/upload?key=2f849a5d4dde177303747fa11e575984",I).subscribe({next:b=>{this.avatarUrl=b.data.url,console.log("Imagen subida",this.avatarUrl)},error:b=>{console.error("Error al subir la imagen",b)}})},i.src=e.result},e.readAsDataURL(t)}guardarAvatar(){let a=localStorage.getItem("accessToken");if(!a){console.log("No se encontr\xF3 el token de acceso");return}let t=N.apiUrl+"/usuario/actualizarAvatar";fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({avatarUrl:this.avatarUrl})}).then(e=>e.text()).then(e=>{e.trim()==="Avatar actualizado"?(this.presentToast("Avatar actualizado"),localStorage.setItem("avatarUrl",this.avatarUrl||""),this.router.navigate(["/ajustes"])):this.presentToast("Error: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}cancelar(){this.router.navigate(["/ajustes"])}presentToast(a){this.toastController.create({message:a,duration:2e3,position:"top",cssClass:"custom-toast"}).then(t=>{t.present()})}};s.\u0275fac=function(t){return new(t||s)(v(S),v(V),v(Q))},s.\u0275cmp=C({type:s,selectors:[["app-cambiar-avatar"]],viewQuery:function(t,e){if(t&1&&k(O,5),t&2){let i;T(i=x())&&(e.fileInput=i.first)}},decls:18,vars:3,consts:[["fileInput",""],[3,"translucent"],["slot","start"],["defaultHref","/ajustes"],[3,"fullscreen"],[1,"centrar"],["style","width: 100px; height: 100px; margin-bottom: 20px;",4,"ngIf"],["expand","block",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],[2,"width","100px","height","100px","margin-bottom","20px"],[3,"src"]],template:function(t,e){if(t&1){let i=w();r(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),h(3,"ion-back-button",3),o(),r(4,"ion-title"),g(5,"Cambiar avatar"),o()()(),r(6,"ion-content",4)(7,"div",5),h(8,"br"),y(9,$,2,1,"ion-avatar",6),r(10,"ion-button",7),d("click",function(){return m(i),u(e.selectImage())}),g(11,"Seleccionar Avatar"),o(),r(12,"ion-button",7),d("click",function(){return m(i),u(e.guardarAvatar())}),g(13,"Guardar Avatar"),o(),r(14,"ion-button",7),d("click",function(){return m(i),u(e.cancelar())}),g(15,"Cancelar"),o(),r(16,"input",8,0),d("change",function(c){return m(i),u(e.uploadImage(c))}),o()()()}t&2&&(p("translucent",!0),f(6),p("fullscreen",!0),f(3),p("ngIf",e.avatarUrl))},dependencies:[R,F,H,M,U,E,j,D,B,P,z],encapsulation:2});let l=s;return l})();export{ne as CambiarAvatarPage};
