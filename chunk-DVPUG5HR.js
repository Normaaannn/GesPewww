import{a as ie}from"./chunk-3RMIGUHL.js";import{a as te,b as ne}from"./chunk-CRMNYVNJ.js";import"./chunk-DWTMSAJF.js";import"./chunk-EIUGSWZD.js";import"./chunk-TW6IKH4B.js";import"./chunk-ZWHDOK3R.js";import"./chunk-4PGTP63H.js";import"./chunk-BDVXA75T.js";import"./chunk-HC6MZPB3.js";import"./chunk-I3LG7LOT.js";import"./chunk-FERD25SW.js";import"./chunk-7EU7YSXT.js";import"./chunk-LEIMCQKJ.js";import"./chunk-KKMBB4JE.js";import"./chunk-BZ2JL7UE.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-GZWEEWZ4.js";import"./chunk-MCRJI3T3.js";import"./chunk-MAJNWM2K.js";import"./chunk-5LUBTVRJ.js";import{a as _}from"./chunk-X4PUQNXE.js";import{B as m,Ba as B,Bb as H,Cb as q,D as n,E as o,F as b,Fb as K,Gb as Q,Ha as V,J as P,K as g,L as f,Mb as X,Ob as Y,Pb as Z,Qb as ee,S as p,T as w,U as v,V as x,W as I,X as T,Y as k,fa as E,ga as M,hb as N,j as d,ja as F,k as h,pb as $,r as a,rb as A,s as S,sa as O,sb as U,tb as W,u as y,ub as D,vb as L,wb as j,xb as z,y as C,ya as R,yb as J,zb as G}from"./chunk-GOUZPZED.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";function re(s,c){if(s&1){let r=P();n(0,"ion-segment",14)(1,"ion-segment-button",15),g("click",function(){d(r);let l=f();return h(l.loadClientes(1))}),n(2,"ion-label"),p(3,"Activos"),o()(),n(4,"ion-segment-button",16),g("click",function(){d(r);let l=f();return h(l.loadClientes(2))}),n(5,"ion-label"),p(6,"Inactivos"),o()(),n(7,"ion-segment-button",17),g("click",function(){d(r);let l=f();return h(l.loadClientes(3))}),n(8,"ion-label"),p(9,"Todos"),o()()()}}function le(s,c){if(s&1){let r=P();n(0,"ion-item",18),g("click",function(){let l=d(r).$implicit,e=f();return h(e.goToClienteDetalle(l))}),n(1,"ion-label")(2,"h2"),p(3),o(),n(4,"p"),p(5),o(),n(6,"p"),p(7),o()()()}if(s&2){let r=c.$implicit;m("button",!0),a(3),x("",r.nombre," ",r.apellidos,""),a(2),v("Email: ",r.email,""),a(2),v("Tel\xE9fono: ",(r.telefono+"").slice(0,3)+"-"+(r.telefono+"").slice(3,5)+"-"+(r.telefono+"").slice(5,7)+"-"+(r.telefono+"").slice(7,9)," ")}}function ae(s,c){if(s&1&&(n(0,"ion-select-option",19),p(1),o()),s&2){let r=c.$implicit;m("value",r),a(),w(r)}}var Pe=(()=>{let c=class c{handleRefresh(i){setTimeout(()=>{this.loadClientes(this.segmentButton),i.target.complete()},2e3)}constructor(i){this.router=i,this.clientes=[],this.searchTerm="",this.currentPage=1,this.totalPages=1,this.pageSize=20,this.pageOptions=[],this.segmentButton=1,te({add:ne})}ionViewWillEnter(){this.loadClientes()}loadClientes(i=this.segmentButton){this.segmentButton=i;let l=localStorage.getItem("accessToken");if(!l){console.log("No se encontr\xF3 el token de acceso");return}let e="";if(this.searchTerm.trim()==="")switch(i){case 1:e=_.apiUrl+`/cliente/activos/page/${this.currentPage}`;break;case 2:e=_.apiUrl+`/cliente/inactivos/page/${this.currentPage}`;break;case 3:e=_.apiUrl+`/cliente/todos/page/${this.currentPage}`;break}else switch(i){case 1:e=_.apiUrl+`/cliente/buscar/activos/${this.searchTerm}/page/${this.currentPage}`;break;case 2:e=_.apiUrl+`/cliente/buscar/inactivos/${this.searchTerm}/page/${this.currentPage}`;break;case 3:e=_.apiUrl+`/cliente/buscar/todos/${this.searchTerm}/page/${this.currentPage}`;break}fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}}).then(t=>{if(!t.ok)throw new Error("Error en la solicitud");return t.json()}).then(t=>{console.log("Respuesta completa:",t),typeof t=="string"&&(t=JSON.parse(t),console.log("Convertido a JSON:",t)),Array.isArray(t)?this.clientes=t:t&&t.content?(this.clientes=t.content,this.totalPages=t.totalPages||1,this.pageOptions=Array.from({length:this.totalPages},(u,oe)=>oe+1)):console.warn("Formato de datos inesperado:",t)})}changePage(i){i==="prev"&&this.currentPage>1?this.currentPage--:i==="next"&&this.currentPage<this.totalPages&&this.currentPage++,this.loadClientes()}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadClientes())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadClientes())}goToClienteDetalle(i){this.router.navigate(["/cliente-detalle"],{state:{cliente:i}})}goToAddCliente(){this.router.navigate(["/cliente-add"])}comprobarRol(){return localStorage.getItem("role")==="ROLE_ADMIN"}};c.\u0275fac=function(l){return new(l||c)(S(O))},c.\u0275cmp=y({type:c,selectors:[["app-clientes"]],decls:25,vars:10,consts:[[3,"translucent"],[3,"fullscreen"],[1,"centrar"],["slot","fixed",3,"ionRefresh"],["horizontal","end","vertical","bottom","slot","fixed",2,"margin-right","7px","margin-bottom","70px"],[3,"click"],["name","add"],["value","activos",4,"ngIf"],["placeholder","Buscar por nombre, NIF, ciudad...",3,"ngModelChange","ionInput","ngModel","debounce"],[3,"button","click",4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","margin-top","20px","margin-bottom","20px"],[3,"click","disabled"],["interface","popover",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value","activos"],["value","activos",3,"click"],["value","inactivos",3,"click"],["value","todos",3,"click"],[3,"click","button"],[3,"value"]],template:function(l,e){l&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title")(3,"b"),p(4,"Clientes"),o()()()(),n(5,"ion-content",1)(6,"div",2)(7,"ion-refresher",3),g("ionRefresh",function(u){return e.handleRefresh(u)}),b(8,"ion-refresher-content"),o(),n(9,"ion-fab",4)(10,"ion-fab-button",5),g("click",function(){return e.goToAddCliente()}),b(11,"ion-icon",6),o()(),C(12,re,10,0,"ion-segment",7),n(13,"ion-searchbar",8),k("ngModelChange",function(u){return T(e.searchTerm,u)||(e.searchTerm=u),u}),g("ionInput",function(){return e.loadClientes()}),o(),n(14,"ion-list"),C(15,le,8,5,"ion-item",9),o(),n(16,"div",10)(17,"ion-button",11),g("click",function(){return e.changePage("prev")}),p(18,"\u2190"),o(),n(19,"ion-select",12),k("ngModelChange",function(u){return T(e.currentPage,u)||(e.currentPage=u),u}),g("ionChange",function(){return e.loadClientes()}),C(20,ae,2,2,"ion-select-option",13),o(),n(21,"ion-button",11),g("click",function(){return e.changePage("next")}),p(22,"\u2192"),o()()()(),n(23,"ion-footer"),b(24,"app-tabs"),o()),l&2&&(m("translucent",!0),a(5),m("fullscreen",!0),a(7),m("ngIf",e.comprobarRol()),a(),I("ngModel",e.searchTerm),m("debounce",1e3),a(2),m("ngForOf",e.clientes),a(2),m("disabled",e.currentPage===1),a(2),I("ngModel",e.currentPage),a(),m("ngForOf",e.pageOptions),a(),m("disabled",e.currentPage===e.totalPages))},dependencies:[$,D,K,Q,F,E,M,V,R,B,N,ee,q,L,j,z,X,J,G,ie,W,A,U,Y,Z,H],styles:['@charset "UTF-8";ion-select[_ngcontent-%COMP%]{max-width:120px;min-width:80px;width:auto;text-align:center}ion-segment-button[_ngcontent-%COMP%]{height:60px}']});let s=c;return s})();export{Pe as ClientesPage};
