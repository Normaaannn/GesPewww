import{a as oe}from"./chunk-JRZRF2AF.js";import{a as ee,b as te}from"./chunk-CRMNYVNJ.js";import"./chunk-QQYICIZX.js";import"./chunk-EIUGSWZD.js";import"./chunk-TW6IKH4B.js";import"./chunk-ZWHDOK3R.js";import"./chunk-4PGTP63H.js";import"./chunk-BDVXA75T.js";import"./chunk-HC6MZPB3.js";import"./chunk-I3LG7LOT.js";import"./chunk-FERD25SW.js";import"./chunk-7EU7YSXT.js";import"./chunk-LEIMCQKJ.js";import"./chunk-KKMBB4JE.js";import"./chunk-BZ2JL7UE.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-GZWEEWZ4.js";import"./chunk-MCRJI3T3.js";import"./chunk-MAJNWM2K.js";import"./chunk-5LUBTVRJ.js";import{a as g}from"./chunk-GGPG3CNO.js";import{Ab as J,B as u,Ca as R,Cb as G,D as o,Db as H,E as i,F as b,Gb as q,Hb as K,Ia as V,J as v,K as d,L as P,Nb as Q,Pb as X,Qb as Y,Rb as Z,S as m,T as I,U as T,X as k,Y as S,Z as y,ga as x,ha as E,ib as B,j as _,k as h,ka as M,qb as A,r as a,s as C,sb as N,ta as F,tb as $,u as w,ub as U,vb as W,wb as D,xb as L,y as f,yb as j,za as O,zb as z}from"./chunk-XGKQ7DCH.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";function ie(c,l){if(c&1){let s=v();o(0,"ion-segment",14)(1,"ion-segment-button",15),d("click",function(){_(s);let r=P();return h(r.loadProductos(1))}),o(2,"ion-label"),m(3,"Activos"),i()(),o(4,"ion-segment-button",16),d("click",function(){_(s);let r=P();return h(r.loadProductos(2))}),o(5,"ion-label"),m(6,"Inactivos"),i()(),o(7,"ion-segment-button",17),d("click",function(){_(s);let r=P();return h(r.loadProductos(3))}),o(8,"ion-label"),m(9,"Todos"),i()()()}}function re(c,l){if(c&1){let s=v();o(0,"ion-item",18),d("click",function(){let r=_(s).$implicit,e=P();return h(e.goToProductoDetalle(r))}),o(1,"ion-label")(2,"h2"),m(3),i(),o(4,"p"),m(5),i(),o(6,"p"),m(7),i()()()}if(c&2){let s=l.$implicit;u("button",!0),a(3),I(s.nombre),a(2),T("Descripci\xF3n: ",s.descripcion,""),a(2),T("Precio neto: ",s.precioNeto," \u20AC")}}function ae(c,l){if(c&1&&(o(0,"ion-select-option",19),m(1),i()),c&2){let s=l.$implicit;u("value",s),a(),I(s)}}var be=(()=>{let l=class l{handleRefresh(n){setTimeout(()=>{this.loadProductos(),n.target.complete()},2e3)}constructor(n){this.router=n,this.productos=[],this.searchTerm="",this.currentPage=1,this.totalPages=1,this.pageSize=20,this.pageOptions=[],this.segmentButton=1,this.dataLoaded=!1,ee({add:te})}ionViewWillEnter(){this.loadProductos()}loadProductos(n=this.segmentButton){this.segmentButton=n;let r=localStorage.getItem("accessToken");if(!r){console.log("No se encontr\xF3 el token de acceso");return}let e="";if(this.searchTerm.trim()==="")switch(n){case 1:e=g.apiUrl+`/producto/activos/page/${this.currentPage}`;break;case 2:e=g.apiUrl+`/producto/inactivos/page/${this.currentPage}`;break;case 3:e=g.apiUrl+`/producto/todos/page/${this.currentPage}`;break}else switch(n){case 1:e=g.apiUrl+`/producto/buscar/activos/${this.searchTerm}/page/${this.currentPage}`;break;case 2:e=g.apiUrl+`/producto/buscar/inactivos/${this.searchTerm}/page/${this.currentPage}`;break;case 3:e=g.apiUrl+`/producto/buscar/todos/${this.searchTerm}/page/${this.currentPage}`;break}fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}).then(t=>{if(!t.ok)throw new Error("Error en la solicitud");return t.json()}).then(t=>{console.log("Respuesta completa:",t),typeof t=="string"&&(t=JSON.parse(t),console.log("Convertido a JSON:",t)),Array.isArray(t)?this.productos=t:t&&t.content?(this.productos=t.content,this.totalPages=t.totalPages||1,this.pageOptions=Array.from({length:this.totalPages},(p,ne)=>ne+1)):console.warn("Formato de datos inesperado:",t)})}changePage(n){n==="prev"&&this.currentPage>1?this.currentPage--:n==="next"&&this.currentPage<this.totalPages&&this.currentPage++,this.loadProductos()}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadProductos())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadProductos())}goToProductoDetalle(n){this.router.navigate(["/producto-detalle"],{state:{producto:n}})}goToAddProducto(){this.router.navigate(["/producto-add"])}comprobarRol(){return localStorage.getItem("role")==="ROLE_ADMIN"}};l.\u0275fac=function(r){return new(r||l)(C(F))},l.\u0275cmp=w({type:l,selectors:[["app-productos"]],decls:25,vars:10,consts:[[3,"translucent"],[3,"fullscreen"],[1,"centrar"],["slot","fixed",3,"ionRefresh"],["horizontal","end","vertical","bottom","slot","fixed",2,"margin-right","7px","margin-bottom","70px"],[3,"click"],["name","add"],["value","activos",4,"ngIf"],["placeholder","Buscar por nombre...",3,"ngModelChange","ionInput","ngModel","debounce"],[3,"button","click",4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","margin-top","20px","margin-bottom","20px"],[3,"click","disabled"],["interface","popover",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value","activos"],["value","activos",3,"click"],["value","inactivos",3,"click"],["value","todos",3,"click"],[3,"click","button"],[3,"value"]],template:function(r,e){r&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title")(3,"b"),m(4,"Productos"),i()()()(),o(5,"ion-content",1)(6,"div",2)(7,"ion-refresher",3),d("ionRefresh",function(p){return e.handleRefresh(p)}),b(8,"ion-refresher-content"),i(),o(9,"ion-fab",4)(10,"ion-fab-button",5),d("click",function(){return e.goToAddProducto()}),b(11,"ion-icon",6),i()(),f(12,ie,10,0,"ion-segment",7),o(13,"ion-searchbar",8),y("ngModelChange",function(p){return S(e.searchTerm,p)||(e.searchTerm=p),p}),d("ionInput",function(){return e.loadProductos()}),i(),o(14,"ion-list"),f(15,re,8,4,"ion-item",9),i(),o(16,"div",10)(17,"ion-button",11),d("click",function(){return e.changePage("prev")}),m(18,"\u2190"),i(),o(19,"ion-select",12),y("ngModelChange",function(p){return S(e.currentPage,p)||(e.currentPage=p),p}),d("ionChange",function(){return e.loadProductos()}),f(20,ae,2,2,"ion-select-option",13),i(),o(21,"ion-button",11),d("click",function(){return e.changePage("next")}),m(22,"\u2192"),i()()()(),o(23,"ion-footer"),b(24,"app-tabs"),i()),r&2&&(u("translucent",!0),a(5),u("fullscreen",!0),a(7),u("ngIf",e.comprobarRol()),a(),k("ngModel",e.searchTerm),u("debounce",1e3),a(2),u("ngForOf",e.productos),a(2),u("disabled",e.currentPage===1),a(2),k("ngModel",e.currentPage),a(),u("ngForOf",e.pageOptions),a(),u("disabled",e.currentPage===e.totalPages))},dependencies:[A,W,q,K,M,x,E,V,O,R,B,Z,H,D,L,j,Q,z,J,oe,U,N,$,X,Y,G],styles:['@charset "UTF-8";ion-select[_ngcontent-%COMP%]{max-width:120px;min-width:80px;width:auto;text-align:center}ion-segment-button[_ngcontent-%COMP%]{height:60px}']});let c=l;return c})();export{be as ProductosPage};
