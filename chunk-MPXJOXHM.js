import{a as N}from"./chunk-GGPG3CNO.js";import{B as p,D as i,E as o,F as h,J as w,K as d,Kb as F,L as U,La as j,Lb as H,Ob as Q,P as A,Q as T,R as k,S as g,eb as P,ha as S,j as m,k as u,kb as z,la as x,lb as B,ma as E,mb as D,q as _,r as v,s as f,tb as M,u as C,ua as V,y,yb as R}from"./chunk-37LTOCVS.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";var L=["fileInput"];function $(s,l){if(s&1&&(i(0,"ion-avatar",9),h(1,"img",10),o()),s&2){let O=U();v(),p("src",O.avatarUrl,_)}}var ne=(()=>{let l=class l{constructor(a,t,e){this.http=a,this.router=t,this.toastController=e,this.avatarUrl=null}ngOnInit(){this.avatarUrl=localStorage.getItem("avatarUrl")||null}selectImage(){this.fileInput.nativeElement.click()}uploadImage(a){let t=a.target.files[0];if(!t)return;let e=new FileReader;e.onload=()=>{let r=new Image;r.onload=()=>{let n=document.createElement("canvas"),c=n.getContext("2d");n.width=100,n.height=100,c==null||c.drawImage(r,0,0,100,100);let K=n.toDataURL("image/jpeg",.7).replace(/^data:image\/jpeg;base64,/,""),I=new FormData;I.append("image",K),this.http.post("https://api.imgbb.com/1/upload?key=2f849a5d4dde177303747fa11e575984",I).subscribe({next:b=>{this.avatarUrl=b.data.url,console.log("Imagen subida",this.avatarUrl)},error:b=>{console.error("Error al subir la imagen",b)}})},r.src=e.result},e.readAsDataURL(t)}guardarAvatar(){let a=localStorage.getItem("accessToken");if(!a){console.log("No se encontr\xF3 el token de acceso");return}if(!this.avatarUrl||this.avatarUrl===localStorage.getItem("avatarUrl")){this.presentToast("Selecciona una imagen para el avatar");return}let t=N.apiUrl+"/usuario/actualizarAvatar";fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({avatarUrl:this.avatarUrl})}).then(e=>e.text()).then(e=>{e.trim()==="Avatar actualizado"?(this.presentToast("Avatar actualizado"),localStorage.setItem("avatarUrl",this.avatarUrl||""),this.router.navigate(["/ajustes"])):this.presentToast("Error: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}cancelar(){this.router.navigate(["/ajustes"])}presentToast(a){this.toastController.create({message:a,duration:2e3,position:"top",cssClass:"toast"}).then(t=>{t.present()})}};l.\u0275fac=function(t){return new(t||l)(f(E),f(V),f(Q))},l.\u0275cmp=C({type:l,selectors:[["app-cambiar-avatar"]],viewQuery:function(t,e){if(t&1&&A(L,5),t&2){let r;T(r=k())&&(e.fileInput=r.first)}},decls:18,vars:3,consts:[["fileInput",""],[3,"translucent"],["slot","start"],["defaultHref","/ajustes"],[3,"fullscreen"],[1,"centrar"],["style","width: 100px; height: 100px; margin: 0 auto;",4,"ngIf"],["expand","block",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],[2,"width","100px","height","100px","margin","0 auto"],[3,"src"]],template:function(t,e){if(t&1){let r=w();i(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),h(3,"ion-back-button",3),o(),i(4,"ion-title"),g(5,"Cambiar avatar"),o()()(),i(6,"ion-content",4)(7,"div",5),h(8,"br"),y(9,$,2,1,"ion-avatar",6),i(10,"ion-button",7),d("click",function(){return m(r),u(e.selectImage())}),g(11,"Subir Avatar"),o(),i(12,"ion-button",7),d("click",function(){return m(r),u(e.guardarAvatar())}),g(13,"Guardar Avatar"),o(),i(14,"ion-button",7),d("click",function(){return m(r),u(e.cancelar())}),g(15,"Cancelar"),o(),i(16,"input",8,0),d("change",function(c){return m(r),u(e.uploadImage(c))}),o()()()}t&2&&(p("translucent",!0),v(6),p("fullscreen",!0),v(3),p("ngIf",e.avatarUrl))},dependencies:[M,R,F,H,x,S,j,B,z,D,P],styles:["ion-button[_ngcontent-%COMP%]{padding:20px 20px 0}"]});let s=l;return s})();export{ne as CambiarAvatarPage};
