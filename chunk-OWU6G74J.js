import{b as X,c as Y,d as Z,e as $,f as ee,h as te,i as oe,j as ie,k as re,m as ne,n as ae,o as le,p as se}from"./chunk-T5ABTVR2.js";import"./chunk-EIUGSWZD.js";import"./chunk-TW6IKH4B.js";import"./chunk-ZWHDOK3R.js";import"./chunk-4PGTP63H.js";import"./chunk-BDVXA75T.js";import"./chunk-HC6MZPB3.js";import"./chunk-I3LG7LOT.js";import"./chunk-FERD25SW.js";import"./chunk-7EU7YSXT.js";import"./chunk-LEIMCQKJ.js";import"./chunk-KKMBB4JE.js";import"./chunk-BZ2JL7UE.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-GZWEEWZ4.js";import"./chunk-MCRJI3T3.js";import"./chunk-MAJNWM2K.js";import"./chunk-5LUBTVRJ.js";import{a as I}from"./chunk-GGPG3CNO.js";import{B as a,Ba as D,C as b,Ca as k,D as l,Da as W,E as s,Ea as A,F as f,Fa as O,G as N,H as S,Ia as H,J as x,Ja as z,K as E,Kb as U,L as _,La as L,Lb as J,Ob as K,S as g,Sb as Q,X as P,Y as C,Z as v,ha as w,j as m,k as p,la as B,lb as j,r as o,s as F,tb as q,u as M,ua as V,y,yb as R,zb as G}from"./chunk-37LTOCVS.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as T}from"./chunk-RW4GY4BD.js";function ce(i,d){i&1&&(l(0,"ion-buttons",12),f(1,"ion-back-button",13),s())}function de(i,d){if(i&1){let c=x();N(0),l(1,"ion-button",14),E("click",function(){m(c);let r=_();return p(r.activarEdicion())}),g(2," Editar producto "),s(),l(3,"ion-button",15),E("click",function(){m(c);let r=_();return p(r.atras())}),g(4," Atr\xE1s "),s(),S()}}function ue(i,d){i&1&&(l(0,"ion-button",24),g(1," Eliminar "),s())}function me(i,d){if(i&1&&f(0,"ion-alert",25),i&2){let c=_(2);a("buttons",c.alertButtonsEliminar)}}function pe(i,d){i&1&&(l(0,"ion-button",26),g(1," Habilitar "),s())}function ge(i,d){if(i&1&&f(0,"ion-alert",27),i&2){let c=_(2);a("buttons",c.alertButtonsHabilitar)}}function he(i,d){if(i&1&&(N(0),l(1,"ion-button",16),g(2," Guardar "),s(),f(3,"ion-alert",17),l(4,"ion-button",18),g(5," Cancelar "),s(),f(6,"ion-alert",19),y(7,ue,2,0,"ion-button",20)(8,me,1,1,"ion-alert",21)(9,pe,2,0,"ion-button",22)(10,ge,1,1,"ion-alert",23),S()),i&2){let c=_();o(),b("disabled",c.formInvalid),o(2),a("buttons",c.alertButtonsGuardar),o(3),a("buttons",c.alertButtonsCancelar),o(),a("ngIf",c.activo),o(),a("ngIf",c.activo),o(),a("ngIf",!c.activo),o(),a("ngIf",!c.activo)}}var Me=(()=>{let d=class d{constructor(t,r){this.router=t,this.toastController=r,this.nombre="",this.descripcion="",this.precioNeto="",this.iva="",this.precioBruto="",this.activo=null,this.fechaRegistro=null,this.formSubmitted=!1,this.modoEdicion=!1,this.nombreForm="",this.descripcionForm="",this.precioNetoForm="",this.ivaForm="",this.alertButtonsEliminar=[{text:"No",cssClass:"alert-button-cancel"},{text:"Si",cssClass:"alert-button-confirm",handler:()=>{this.eliminarProducto()}}],this.alertButtonsHabilitar=[{text:"No",cssClass:"alert-button-cancel"},{text:"Si",cssClass:"alert-button-confirm",handler:()=>{this.habilitarProducto()}}],this.alertButtonsGuardar=[{text:"No",cssClass:"alert-button-cancel"},{text:"Si",cssClass:"alert-button-confirm",handler:()=>{this.updateProducto()}}],this.alertButtonsCancelar=[{text:"No",cssClass:"alert-button-cancel"},{text:"Si",cssClass:"alert-button-confirm",handler:()=>{this.cancelarEdicion()}}]}ngOnInit(){let t=this.router.getCurrentNavigation();t!=null&&t.extras.state&&(this.producto=t.extras.state.producto,this.productoID=this.producto.id,this.nombre=this.producto.nombre||"",this.descripcion=this.producto.descripcion||"",this.precioNeto=this.producto.precioNeto||"",this.iva=this.producto.iva||"",this.activo=this.producto.activo||null,this.fechaRegistro=this.producto.fechaRegistro||null,this.calcularPrecioBruto(),this.nombreForm=this.nombre,this.descripcionForm=this.descripcion,this.precioNetoForm=this.precioNeto,this.ivaForm=this.iva)}get formInvalid(){return!this.nombreForm||!this.descripcionForm||!this.precioNetoForm||!this.ivaForm}calcularPrecioBruto(){this.precioBruto=(parseFloat(this.precioNeto)*(1+parseFloat(this.iva)/100)).toString()}updateProducto(){if(this.formSubmitted=!0,this.formInvalid)return;if(Number(this.precioNeto)<0||Number(this.precioNeto)>9999999999||Number(this.iva)<0||Number(this.iva)>99){this.presentToast("Los valores de precio neto o IVA son negativos o muy grandes.");return}if(this.tieneDecimales(this.precioNeto,2)){this.presentToast("El precio neto no puede tener mas de dos decimales.");return}if(this.tieneDecimales(this.iva,0)){this.presentToast("El iva no puede tener decimales.");return}let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let r=I.apiUrl+`/producto/${this.productoID}`;fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({nombre:this.nombreForm,descripcion:this.descripcionForm,precioNeto:this.precioNetoForm,iva:this.ivaForm})}).then(e=>e.text()).then(e=>{e.trim()==="Producto actualizado"?(this.presentToast("Producto actualizado"),this.nombre=this.nombreForm,this.descripcion=this.descripcionForm,this.precioNeto=this.precioNetoForm,this.iva=this.ivaForm,this.modoEdicion=!1):this.presentToast("Error en el registro: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}activarEdicion(){this.modoEdicion=!0}atras(){this.router.navigate(["/productos"])}cancelarEdicion(){this.modoEdicion=!1,this.nombreForm=this.nombre,this.descripcionForm=this.descripcion,this.precioNetoForm=this.precioNeto,this.ivaForm=this.iva}tieneDecimales(t,r){let u=String(t).replace(",",".").split(".");return u.length<2?!1:u[1].length>r}eliminarProducto(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let r=I.apiUrl+`/producto/${this.productoID}/desactivar`;fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(e=>e.text()).then(e=>{e.trim()==="Producto desactivado correctamente"?(this.presentToast("Producto eliminado"),this.router.navigate(["/productos"])):this.presentToast("Error en el registro: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}habilitarProducto(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let r=I.apiUrl+`/producto/${this.productoID}/activar`;fetch(r,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(e=>e.text()).then(e=>{e.trim()==="Producto activado correctamente"?(this.presentToast("Producto habilitado"),this.router.navigate(["/productos"])):this.presentToast("Error en el registro: "+e)}).catch(e=>{console.error("Error en la solicitud:",e),alert("Error en la solicitud")})}presentToast(t){return T(this,null,function*(){yield(yield this.toastController.create({message:t,duration:2e3,position:"top",cssClass:"toast"})).present()})}};d.\u0275fac=function(r){return new(r||d)(F(V),F(K))},d.\u0275cmp=M({type:d,selectors:[["app-producto-detalle"]],decls:22,vars:22,consts:[["clienteForm","ngForm"],[3,"translucent"],["slot","start",4,"ngIf"],[3,"fullscreen"],[1,"centrar"],[1,"updateProducto",3,"ngSubmit"],["type","text","placeholder","Nombre","name","nombre","label","Nombre","labelPlacement","floating","maxlength","40","required","",3,"ngModelChange","ngModel","readonly"],["type","text","placeholder","Descripci\xF3n","name","descripcion","label","Descripci\xF3n","labelPlacement","floating","maxlength","200","required","",3,"ngModelChange","ngModel","readonly"],["type","number","placeholder","Precio neto","name","precioNeto","label","Precio neto","labelPlacement","floating","maxlength","10","required","",3,"ngModelChange","ngModel","readonly"],["type","number","placeholder","I.V.A.","name","iva","label","I.V.A.","labelPlacement","floating","maxlength","2","required","",3,"ngModelChange","ngModel","readonly"],["type","text","readonly","","placeholder","Precio bruto","name","precioBruto","label","Precio Bruto","labelPlacement","floating",3,"ngModelChange","ngModel"],[4,"ngIf"],["slot","start"],["defaultHref","/productos"],["expand","block",1,"boton-editar-guardar",3,"click"],["expand","block",1,"boton-atras",3,"click"],["id","guardar","expand","block",1,"boton-editar-guardar"],["trigger","guardar","type","submit","header","Vas a guardar los cambios. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"],["id","cancelarEdicion","expand","block",1,"boton-cancelar"],["trigger","cancelarEdicion","header","Vas a cancelar la edici\xF3n. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"],["id","eliminar","expand","block","color","danger","class","boton-eliminar",4,"ngIf"],["trigger","eliminar","class","custom-alert","header","Vas a eliminar el producto. \xBFEst\xE1s seguro?",3,"buttons",4,"ngIf"],["id","habilitar","expand","block","color","success","class","boton-habilitar",4,"ngIf"],["trigger","habilitar","class","custom-alert","header","Vas a habilitar el producto. \xBFEst\xE1s seguro?",3,"buttons",4,"ngIf"],["id","eliminar","expand","block","color","danger",1,"boton-eliminar"],["trigger","eliminar","header","Vas a eliminar el producto. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"],["id","habilitar","expand","block","color","success",1,"boton-habilitar"],["trigger","habilitar","header","Vas a habilitar el producto. \xBFEst\xE1s seguro?",1,"custom-alert",3,"buttons"]],template:function(r,e){if(r&1){let u=x();l(0,"ion-header",1)(1,"ion-toolbar"),y(2,ce,2,0,"ion-buttons",2),l(3,"ion-title"),g(4,"Producto"),s()()(),l(5,"ion-content",3)(6,"div",4)(7,"form",5,0),E("ngSubmit",function(){return m(u),p(e.updateProducto())}),l(9,"ion-item")(10,"ion-input",6),v("ngModelChange",function(n){return m(u),C(e.nombreForm,n)||(e.nombreForm=n),p(n)}),s()(),l(11,"ion-item")(12,"ion-input",7),v("ngModelChange",function(n){return m(u),C(e.descripcionForm,n)||(e.descripcionForm=n),p(n)}),s()(),l(13,"ion-item")(14,"ion-input",8),v("ngModelChange",function(n){return m(u),C(e.precioNetoForm,n)||(e.precioNetoForm=n),p(n)}),s()(),l(15,"ion-item")(16,"ion-input",9),v("ngModelChange",function(n){return m(u),C(e.ivaForm,n)||(e.ivaForm=n),p(n)}),s()(),l(17,"ion-item")(18,"ion-input",10),v("ngModelChange",function(n){return m(u),C(e.precioBruto,n)||(e.precioBruto=n),p(n)}),s(),g(19,"\u20AC "),s(),y(20,de,5,0,"ng-container",11)(21,he,11,8,"ng-container",11),s()()()}r&2&&(a("translucent",!0),o(2),a("ngIf",!e.modoEdicion),o(3),a("fullscreen",!0),o(4),b("invalid",!e.nombre&&e.formSubmitted),o(),P("ngModel",e.nombreForm),a("readonly",!e.modoEdicion),o(),b("invalid",!e.descripcion&&e.formSubmitted),o(),P("ngModel",e.descripcionForm),a("readonly",!e.modoEdicion),o(),b("invalid",!e.precioNeto&&e.formSubmitted),o(),P("ngModel",e.precioNetoForm),a("readonly",!e.modoEdicion),o(),b("invalid",!e.iva&&e.formSubmitted),o(),P("ngModel",e.ivaForm),a("readonly",!e.modoEdicion),o(2),P("ngModel",e.precioBruto),o(2),a("ngIf",!e.modoEdicion),o(),a("ngIf",e.modoEdicion))},dependencies:[q,R,U,J,B,w,L,O,D,k,H,z,A,W,se,Z,$,ee,te,oe,ie,re,ne,ae,X,Y,le,Q,G,j],styles:[".updateProducto[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px;padding-top:20px}.boton-editar-guardar[_ngcontent-%COMP%]{padding:20px}.boton-atras[_ngcontent-%COMP%], .boton-cancelar[_ngcontent-%COMP%]{padding-right:20px;padding-left:20px}.boton-eliminar[_ngcontent-%COMP%], .boton-habilitar[_ngcontent-%COMP%]{padding:20px}.invalid[_ngcontent-%COMP%]{border:2px solid red;--ion-color: red}.error-text[_ngcontent-%COMP%]{color:red;font-size:14px;text-align:center;margin-top:5px}.disabled[_ngcontent-%COMP%]{pointer-events:auto}"]});let i=d;return i})();export{Me as ProductoDetallePage};
