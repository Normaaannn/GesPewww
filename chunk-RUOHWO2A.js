import{a as j,c as O,e as V,g as q,h as G,i as H,j as U,k as z,m as D,n as J,p as K}from"./chunk-DWTMSAJF.js";import"./chunk-EIUGSWZD.js";import"./chunk-TW6IKH4B.js";import"./chunk-ZWHDOK3R.js";import"./chunk-4PGTP63H.js";import"./chunk-BDVXA75T.js";import"./chunk-HC6MZPB3.js";import"./chunk-I3LG7LOT.js";import"./chunk-FERD25SW.js";import"./chunk-7EU7YSXT.js";import"./chunk-LEIMCQKJ.js";import"./chunk-KKMBB4JE.js";import"./chunk-BZ2JL7UE.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-GZWEEWZ4.js";import"./chunk-MCRJI3T3.js";import"./chunk-MAJNWM2K.js";import"./chunk-5LUBTVRJ.js";import{a as I}from"./chunk-GGPG3CNO.js";import{Aa as M,B as C,Ba as w,Ca as k,D as n,E as r,Fa as P,Fb as R,Gb as W,Ha as v,Jb as A,K as g,Kb as F,Nb as B,S as a,W as d,X as p,Y as m,hb as x,ja as b,pb as L,r as c,s as f,sa as T,u as _,ub as E,vb as N,ya as y,za as S}from"./chunk-GOUZPZED.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as h}from"./chunk-RW4GY4BD.js";var ue=(()=>{let s=class s{constructor(o,i){this.router=o,this.toastController=i,this.username="",this.password="",this.mantenerConectado=!1}ngOnInit(){console.log("LoginPage cargada")}login(){fetch(I.apiUrl+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:this.username,password:this.password})}).then(o=>o.json()).then(o=>{o.accessToken&&o.refreshToken&&o.role?(localStorage.setItem("accessToken",o.accessToken),this.mantenerConectado&&localStorage.setItem("refreshToken",o.refreshToken),localStorage.setItem("role",o.role),console.log("Login exitoso"),this.obtenerAvatar().then(()=>{console.log("Avatar obtenido"),this.presentToast("Sesi\xF3n iniciada"),this.router.navigate(["/home"])})):(console.log("Login fallido"),this.presentToast("Credenciales incorrectas"))}).catch(o=>{console.error("Error en la solicitud:",o)})}goToRegistro(){this.router.navigate(["/registro"])}goToRecuperarPass(){this.router.navigate(["/recover-password"])}obtenerAvatar(){return h(this,null,function*(){let o=localStorage.getItem("accessToken");if(!o){console.log("No se encontr\xF3 el token de acceso");return}let i=I.apiUrl+"/usuario/obtenerAvatar";return fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}}).then(e=>e.text()).then(e=>{console.log("Respuesta completa:",e),e?localStorage.setItem("avatarUrl",e):console.log("No se encontr\xF3 el avatar")}).catch(e=>{console.error("Error en la solicitud:",e)})})}presentToast(o){return h(this,null,function*(){yield(yield this.toastController.create({message:o,duration:2e3,position:"top"})).present()})}};s.\u0275fac=function(i){return new(i||s)(f(T),f(A))},s.\u0275cmp=_({type:s,selectors:[["app-login"]],decls:22,vars:5,consts:[[3,"translucent"],[3,"fullscreen"],[1,"centrar"],[2,"font-size","50px","padding","15px"],[1,"login",3,"ngSubmit"],["type","text","placeholder","Usuario","name","username","label","Usuario","labelPlacement","floating","required","",3,"ngModelChange","ngModel"],["type","password","placeholder","Contrase\xF1a","name","password","label","Contrase\xF1a","labelPlacement","floating","required","",3,"ngModelChange","ngModel"],["expand","block","type","submit",1,"boton-login"],["labelPlacement","end",2,"padding-bottom","20px","padding-left","20px",3,"ngModelChange","ngModel"],["expand","block",1,"boton-registro-recover",3,"click"]],template:function(i,e){i&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title")(3,"b"),a(4,"GesPe"),r()()()(),n(5,"ion-content",1)(6,"div",2)(7,"h1",3),a(8,"Iniciar sesi\xF3n"),r(),n(9,"form",4),g("ngSubmit",function(){return e.login()}),n(10,"ion-item")(11,"ion-input",5),m("ngModelChange",function(t){return p(e.username,t)||(e.username=t),t}),r()(),n(12,"ion-item")(13,"ion-input",6),m("ngModelChange",function(t){return p(e.password,t)||(e.password=t),t}),r()(),n(14,"ion-button",7),a(15,"Iniciar sesi\xF3n"),r(),n(16,"ion-checkbox",8),m("ngModelChange",function(t){return p(e.mantenerConectado,t)||(e.mantenerConectado=t),t}),a(17,"Mantener conectado"),r(),n(18,"ion-button",9),g("click",function(){return e.goToRegistro()}),a(19,"Registrarse"),r(),n(20,"ion-button",9),g("click",function(){return e.goToRecuperarPass()}),a(21,"Recuperar contrase\xF1a"),r()()()()),i&2&&(C("translucent",!0),c(5),C("fullscreen",!0),c(6),d("ngModel",e.username),c(2),d("ngModel",e.password),c(3),d("ngModel",e.mantenerConectado))},dependencies:[L,E,R,W,b,v,k,y,S,P,w,M,K,V,q,G,H,U,z,D,J,j,O,B,N,x,F],styles:[".login[_ngcontent-%COMP%]{padding-left:20px;padding-right:20px}.boton-login[_ngcontent-%COMP%]{padding:20px}.boton-registro-recover[_ngcontent-%COMP%]{padding-right:20px;padding-left:20px}"]});let u=s;return u})();export{ue as LoginPage};
