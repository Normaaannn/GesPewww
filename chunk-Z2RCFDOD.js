import{a as fe}from"./chunk-FHTXXS3H.js";import{a as ae,b as le,d as se,e as de,f as ce,g as me,j as pe,k as ge,n as he,s as ue,x as _e}from"./chunk-DIOT67RP.js";import"./chunk-LCM7M6OW.js";import"./chunk-EIUGSWZD.js";import"./chunk-TW6IKH4B.js";import"./chunk-ZWHDOK3R.js";import"./chunk-4PGTP63H.js";import"./chunk-BDVXA75T.js";import"./chunk-HC6MZPB3.js";import"./chunk-I3LG7LOT.js";import"./chunk-FERD25SW.js";import"./chunk-7EU7YSXT.js";import"./chunk-LEIMCQKJ.js";import"./chunk-KKMBB4JE.js";import"./chunk-BZ2JL7UE.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-GZWEEWZ4.js";import"./chunk-MCRJI3T3.js";import"./chunk-MAJNWM2K.js";import"./chunk-5LUBTVRJ.js";import{a as re}from"./chunk-GGPG3CNO.js";import{B as d,Bb as K,Ca as R,Cb as Q,D as r,Db as X,E as o,F as P,Fb as Z,Ib as ee,J as x,Ja as W,Jb as te,K as p,L as g,Ob as ne,Pb as ie,S as m,T as F,Tb as oe,U as y,V as T,X as I,Y as w,Z as M,aa as v,ba as E,db as A,ga as D,j as _,ja as O,jb as L,k as f,ka as k,qb as N,r as s,rb as z,s as S,sb as j,ta as V,tb as U,u as b,ub as $,vb as H,wb as J,xb as Y,y as C,yb as G,za as B,zb as q}from"./chunk-GKQ2PQVS.js";import"./chunk-L2GIMNSN.js";import"./chunk-7KGURMOZ.js";import"./chunk-YZINE4VV.js";import"./chunk-OITPVWB3.js";import"./chunk-YXCBSPVC.js";import"./chunk-HII7ZFLR.js";import"./chunk-7JVEMCNU.js";import"./chunk-Z65EUC5N.js";import"./chunk-4U6PRYVA.js";import"./chunk-ETCIABSX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-RW4GY4BD.js";function xe(a,c){if(a&1){let i=x();r(0,"ion-datetime",17),M("ngModelChange",function(e){_(i);let n=g();return w(n.fechaInicio,e)||(n.fechaInicio=e),f(e)}),p("ionChange",function(){_(i);let e=g();return f(e.loadPedidos())}),o()}if(a&2){let i=g();I("ngModel",i.fechaInicio),d("max",i.getFechaMinMax(!0))("showDefaultButtons",!0)}}function Ie(a,c){if(a&1){let i=x();r(0,"ion-datetime",18),M("ngModelChange",function(e){_(i);let n=g();return w(n.fechaFin,e)||(n.fechaFin=e),f(e)}),p("ionChange",function(){_(i);let e=g();return f(e.loadPedidos())}),o()}if(a&2){let i=g();I("ngModel",i.fechaFin),d("min",i.getFechaMinMax(!1))("showDefaultButtons",!0)}}function we(a,c){if(a&1){let i=x();r(0,"ion-item",19),p("click",function(){let e=_(i).$implicit,n=g();return f(n.goToPedidoDetalle(e))}),r(1,"ion-label")(2,"h2"),m(3),o(),r(4,"p"),m(5),o(),r(6,"p"),m(7),v(8,"number"),o()()()}if(a&2){let i=c.$implicit;d("button",!0),s(3),y("Pedido #",i.id,""),s(2),T("Cliente: ",i.cliente.nombre," ",i.cliente.apellidos,""),s(2),y("Total: ",E(8,5,i.total,"1.2-2")," \u20AC")}}function Me(a,c){if(a&1&&(r(0,"ion-select-option",20),m(1),o()),a&2){let i=c.$implicit;d("value",i),s(),F(i)}}var Le=(()=>{let c=class c{handleRefresh(t){setTimeout(()=>{this.loadPedidos(),t.target.complete()},2e3)}constructor(t){this.router=t,this.pedidos=[],this.currentPage=1,this.totalPages=1,this.pageSize=20,this.pageOptions=[],this.fechaInicio=new Date().toISOString(),this.fechaFin=new Date().toISOString(),this.isMenuOpen=!1,this.avatarUrl=null,ae({add:le,chevronDownCircle:se,chevronForwardCircle:de,chevronUpCircle:ce,colorPalette:me,document:pe,globe:he,settingsSharp:_e,ellipsisVertical:ge,logOutOutline:ue})}ionViewWillEnter(){this.loadPedidos(),this.fechaFin=this.getFechaMinMax(!1)}loadPedidos(){let t=localStorage.getItem("accessToken");if(!t){console.log("No se encontr\xF3 el token de acceso");return}let e=new Date(this.fechaInicio).getMonth()+1,n=new Date(this.fechaInicio).getFullYear(),h=new Date(this.fechaFin).getMonth()+1,u=new Date(this.fechaFin).getFullYear(),Pe=re.apiUrl+`/pedido/buscar?&year1=${n}&month1=${e}&year2=${u}&month2=${h}&page=${this.currentPage}`;fetch(Pe,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}).then(l=>{if(!l.ok)throw new Error("Error en la solicitud");return l.json()}).then(l=>{console.log("Respuesta completa:",l),typeof l=="string"&&(l=JSON.parse(l),console.log("Convertido a JSON:",l)),Array.isArray(l)?this.pedidos=l:l&&l.content?(this.pedidos=l.content,this.totalPages=l.totalPages||1,this.pageOptions=Array.from({length:this.totalPages},(ye,Ce)=>Ce+1)):console.warn("Formato de datos inesperado:",l)})}changePage(t){t==="prev"&&this.currentPage>1?this.currentPage--:t==="next"&&this.currentPage<this.totalPages&&this.currentPage++,this.loadPedidos()}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadPedidos())}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadPedidos())}goToPedidoDetalle(t){this.router.navigate(["/pedido-detalle"],{state:{pedidoId:t.id,pedidoFecha:t.fechaEmision,cliente:t.cliente,usuarioCreador:t.usuarioCreador.username}})}goToAddPedido(){this.router.navigate(["/pedido-add"])}getFechaMinMax(t=!1){if(t){let e=new Date(this.fechaFin);return e.setMonth(e.getMonth()-1),e.toISOString()}else{let e=new Date(this.fechaInicio);return e.setMonth(e.getMonth()+1),e.toISOString()}}};c.\u0275fac=function(e){return new(e||c)(S(V))},c.\u0275cmp=b({type:c,selectors:[["app-pedidos"]],decls:37,vars:9,consts:[[3,"translucent"],[3,"fullscreen"],[1,"centrar"],["slot","fixed",3,"ionRefresh"],["horizontal","end","vertical","bottom","slot","fixed",2,"margin-right","7px","margin-bottom","70px"],[3,"click"],["name","add"],[1,"fecha"],["size","6"],["datetime","fechaInicio"],["datetime","fechaFin"],[3,"keepContentsMounted"],[3,"button","click",4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","margin-top","20px","margin-bottom","20px"],[3,"click","disabled"],["interface","popover",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["id","fechaInicio","presentation","month-year","doneText","Confirmar","cancelText","Cancelar",3,"ngModelChange","ionChange","ngModel","max","showDefaultButtons"],["id","fechaFin","presentation","month-year","doneText","Confirmar","cancelText","Cancelar",3,"ngModelChange","ionChange","ngModel","min","showDefaultButtons"],[3,"click","button"],[3,"value"]],template:function(e,n){e&1&&(r(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title")(3,"b"),m(4,"Pedidos"),o()()()(),r(5,"ion-content",1)(6,"div",2)(7,"ion-refresher",3),p("ionRefresh",function(u){return n.handleRefresh(u)}),P(8,"ion-refresher-content"),o(),r(9,"ion-fab",4)(10,"ion-fab-button",5),p("click",function(){return n.goToAddPedido()}),P(11,"ion-icon",6),o()(),r(12,"div",7)(13,"ion-row")(14,"ion-col",8)(15,"p"),m(16,"Desde"),o(),P(17,"ion-datetime-button",9),o(),r(18,"ion-col",8)(19,"p"),m(20,"Hasta"),o(),P(21,"ion-datetime-button",10),o()(),r(22,"ion-modal",11),C(23,xe,1,3,"ng-template"),o(),r(24,"ion-modal",11),C(25,Ie,1,3,"ng-template"),o()(),r(26,"ion-list"),C(27,we,9,8,"ion-item",12),o(),r(28,"div",13)(29,"ion-button",14),p("click",function(){return n.changePage("prev")}),m(30,"\u2190"),o(),r(31,"ion-select",15),M("ngModelChange",function(u){return w(n.currentPage,u)||(n.currentPage=u),u}),p("ionChange",function(){return n.loadPedidos()}),C(32,Me,2,2,"ion-select-option",16),o(),r(33,"ion-button",14),p("click",function(){return n.changePage("next")}),m(34,"\u2192"),o()()()(),r(35,"ion-footer"),P(36,"app-tabs"),o()),e&2&&(d("translucent",!0),s(5),d("fullscreen",!0),s(17),d("keepContentsMounted",!0),s(2),d("keepContentsMounted",!0),s(3),d("ngForOf",n.pedidos),s(2),d("disabled",n.currentPage===1),s(2),I("ngModel",n.currentPage),s(),d("ngForOf",n.pageOptions),s(),d("disabled",n.currentPage===n.totalPages))},dependencies:[z,J,ee,te,k,D,O,W,B,R,L,oe,Z,Y,G,q,ie,K,Q,fe,H,U,$,ne,j,A,X,N],styles:['@charset "UTF-8";ion-select[_ngcontent-%COMP%]{max-width:120px;min-width:80px;width:auto;text-align:center}@media (prefers-color-scheme: light){.icon-opciones[_ngcontent-%COMP%]{color:#000}}.fecha[_ngcontent-%COMP%]{max-width:768px;width:100%;padding:0 1rem;box-sizing:border-box}']});let a=c;return a})();export{Le as PedidosPage};
